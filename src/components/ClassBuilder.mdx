import CodeBlock from '@theme/CodeBlock';
import Admonition from '@theme/Admonition';

import { AuthorityType, BasicType, Classes, Structs, Enums, AssetPath } from '@site/docs/components/_nanos.mdx';

import BaseActorFunctions from '@site/docs/scripting-reference/classes/base-classes/_base-actor-functions.mdx';
import BasePaintableFunctions from '@site/docs/scripting-reference/classes/base-classes/_base-paintable-functions.mdx';
import BasePickableFunctions from '@site/docs/scripting-reference/classes/base-classes/_base-pickable-functions.mdx';

import BaseActorEvents from '@site/docs/scripting-reference/classes/base-classes/_base-actor-events.mdx';
import BasePickableEvents from '@site/docs/scripting-reference/classes/base-classes/_base-pickable-events.mdx';

<!-- Asset Paths Map -->
export const AssetPaths = {
	StaticMeshPath: AssetPath.StaticMesh,
	SkeletalMeshPath: AssetPath.SkeletalMesh,
	AnimationPath: AssetPath.Animation,
	ParticlePath: AssetPath.Particle,
	MaterialPath: AssetPath.Material,
	MapPath: AssetPath.Map,
	BlueprintPath: AssetPath.Blueprint,
	SoundPath: AssetPath.Sound,
	ImagePath: AssetPath.Image,
	HTMLPath: AssetPath.HTML,
}

<!-- Gets an Element by it's string type -->
export function GetElementByType(type) {
	const type_uppercase = type.charAt(0).toUpperCase() + type.slice(1);
	const TypeElement =
		BasicType[type_uppercase] ? BasicType[type_uppercase] :
		Classes[type] ? Classes[type] :
		AssetPaths[type] ? AssetPaths[type] :
		Structs[type] ? Structs[type] : null;
	if (!TypeElement)
		return <Enums>{type}</Enums>;
	return <TypeElement />;
}

<!-- Authority Label Map -->
export const AuthorityLabels = {
	client: <>This class can only be spawned on ðŸŸ§ <a href="/docs/core-concepts/scripting/authority-concepts">Client</a>.</>,
	server: <>This class can only be spawned on ðŸŸ¦ <a href="/docs/core-concepts/scripting/authority-concepts">Server</a>.</>,
	both: <>This class can be spawned on both ðŸŸ§ <a href="/docs/core-concepts/scripting/authority-concepts">Client</a> and ðŸŸ¦ <a href="/docs/core-concepts/scripting/authority-concepts">Server</a> (if you spawn it on client, it won't be synchronized with other players).</>,
}

<!-- Authority Label Map for Static Classes -->
export const AuthorityLabelsStatic = {
	client: <>This static class can be accessed only on ðŸŸ§ <a href="/docs/core-concepts/scripting/authority-concepts">Client</a>.</>,
	server: <>This static class can be accessed only on ðŸŸ¦ <a href="/docs/core-concepts/scripting/authority-concepts">Server</a>.</>,
	both: <>This static class can be accessed on both ðŸŸ§ <a href="/docs/core-concepts/scripting/authority-concepts">Client</a> and ðŸŸ¦ <a href="/docs/core-concepts/scripting/authority-concepts">Server</a>.</>,
}

<!-- Gets a Parameter name (with ? when optional) -->
export function GetParameterName(parameter_data) {
	return `${parameter_data.name}${parameter_data.default != null ? "?" : ""}`;
}

<!-- Gets a list of parameters separated by comma -->
export function GetParametersList(list) {
	return !list ? "" : list.map((value) => GetParameterName(value)).join(", ");
}

<!-- Generates Constructor Example Codeblock -->
export function GetConstructorExample(class_data) {
	return `local my_entity = ${class_data.name}(${GetParametersList(class_data.constructor)})`;
}

<!-- Generates Function Example Codeblock -->
export function GetFunctionExample(function_data) {
	const return_part = !function_data.return ? "" : "local ret = ";
	return `${return_part}my_entity:${function_data.name}(${GetParametersList(function_data.parameters)})`;
}

<!-- Generates Function Example Codeblock -->
export function GetStaticFunctionExample(class_name, function_data) {
	const return_part = !function_data.return ? "" : "local ret = ";
	return `${return_part}${class_name}.${function_data.name}(${GetParametersList(function_data.parameters)})`;
}

<!-- Generates Event Example Codeblock -->
export function GetEventExample(class_name, event_data) {
	return `${class_name}.Subscribe("${event_data.name}", function(${GetParametersList(event_data.arguments)})\n\nend)`;
}

<!-- Authority Admonition -->
export const AuthorityAdmonition = ({ authority, is_static }) => (
	<Admonition type="info" icon="ðŸ’‚" title="Authority">{ is_static ? AuthorityLabelsStatic[authority] : AuthorityLabels[authority] }</Admonition>
);

<!-- Inheritance Admonition -->
export const InheritanceAdmonition = ({ inheritance }) => (
	<Admonition type="info" icon="ðŸ‘ª" title="Inheritance">
		This class inherits from { inheritance.map(inherit => GetElementByType(inherit)).reduce((prev, next) => [prev, ", ", next]) }.
	</Admonition>
);

<!-- Static Class Admonition -->
export const StaticClassAdmonition = () => (
	<Admonition type="info" icon="ðŸ—¿" title="Static Class">
		This is a <b>Static Class</b>. You can access it's methods directly with <code>.</code>. It is not possible to initialize or create new instances.
	</Admonition>
);

<!-- Gets Authority Element by string -->
export function GetAuthorityType(authority) {
	return authority == "server" ? <AuthorityType.ServerOnly /> :
	authority == "client" ? <AuthorityType.ClientOnly /> :
	authority == "authority" ? <AuthorityType.AuthorityOnly /> :
	authority == "both" ? <AuthorityType.Both /> : "";
};

<!-- Function Block Declaration -->
export const FunctionDeclaration = ({ function_data, is_static, class_name }) => (
	<>
		<h3 id={ function_data.name.toLowerCase() }>
			{ GetAuthorityType(function_data.authority) }
			<code>
				{ function_data.name }
			</code>
		</h3>
		<blockquote>
			<span dangerouslySetInnerHTML={{ __html: function_data.description_long ? function_data.description_long : function_data.description }}></span>
			{ function_data.return ? <><br/><br/>Returns { GetElementByType(function_data.return.type) } ({ <span dangerouslySetInnerHTML={{ __html: function_data.return.description }}></span> })</> : "" }
		</blockquote>
		<CodeBlock className="language-lua">
			{ is_static ? GetStaticFunctionExample(class_name, function_data) : GetFunctionExample(function_data) }
		</CodeBlock>
		{Array.isArray(function_data.parameters) && function_data.parameters.length > 0 ?
			<table style={{ width: "100%", display: "table" }}>
				<thead>
					<tr>
						<th>Type</th>
						<th>Parameter</th>
						<th>Default</th>
						<th>Description</th>
					</tr>
				</thead>
				<tbody>
					{function_data.parameters.map(function(value) {
						return <tr>
							<td>{ GetElementByType(value.type) }</td>
							<td><code>{ GetParameterName(value) }</code></td>
							<td style={{ "white-space": "nowrap" }}>{ value.default != null ? <code>{value.default}</code> : "" }</td>
							<td style={{ "word-break": "break-word" }} dangerouslySetInnerHTML={{ __html: value.description }}></td>
						</tr>;
					})}
				</tbody>
			</table>
		: <></>}
		<hr />
	</>
);

<!-- Event Block Declaration -->
export const EventDeclaration = ({ data, class_name }) => (
	<>
		<h3 id={data.name.toLowerCase()}>
			{ GetAuthorityType(data.authority) }
			<code>
				{data.name}
			</code>
		</h3>
		<blockquote>
			{data.description}
		</blockquote>
		<CodeBlock className="language-lua">
			{ GetEventExample(class_name, data) }
		</CodeBlock>
		{Array.isArray(data.arguments) && data.arguments.length > 0 ?
			<table style={{ width: "100%", display: "table" }}>
				<thead>
					<tr>
						<th>Type</th>
						<th>Argument</th>
						<th>Description</th>
					</tr>
				</thead>
				<tbody>
					{data.arguments.map(function(value) {
						return <tr>
							<td>{ GetElementByType(value.type) }</td>
							<td><code>{ value.name }</code></td>
							<td dangerouslySetInnerHTML={{ __html: value.description }} style={{"word-break": "break-word"}}></td>
						</tr>;
					})}
				</tbody>
			</table>
		: <></>}
		<hr />
	</>
);

<!-- Function List Declaration -->
export const FunctionListDeclaration = ({ functions_list }) => (
	<table style={{ width: "100%", display: "table" }}>
		<thead>
			<tr>
				<th></th>
				<th>Returns</th>
				<th>Name</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			{functions_list.map(function(value) {
				return <tr>
					<td width="50px">{ GetAuthorityType(value.authority) } </td>
					<td>{ value.return ? GetElementByType(value.return.type) : "" }</td>
					<td><b><a href={`#${value.name.toLowerCase()}`}><code>{ value.name }</code></a></b></td>
					<td style={{"word-break": "break-word"}}>{ value.description }</td>
				</tr>;
			})}
		</tbody>
	</table>
);

<!-- Events List Declaration -->
export const EventListDeclaration = ({ class_data }) => (
	<table style={{ width: "100%", display: "table" }}>
		<thead>
			<tr>
				<th></th>
				<th>Name</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			{class_data.events.map(function(value) {
				return <tr>
					<td width="50px">{ GetAuthorityType(value.authority) } </td>
					<td><b><a href={`#${value.name.toLowerCase()}`}><code>{ value.name }</code></a></b></td>
					<td style={{"word-break": "break-word"}}>{ value.description }</td>
				</tr>;
			})}
		</tbody>
	</table>
);

<!-- Header Block Declaration -->
export const HeaderDeclaration = ({ class_data, image, is_static }) => (
	<>
		<p>
			{ class_data.description }
		</p>
		{
			!image ? "" :
			<p>
				<img src={image} />
			</p>
		}
		<AuthorityAdmonition authority={class_data.authority} is_static={is_static} />
		{ class_data.inheritance ? <InheritanceAdmonition inheritance={class_data.inheritance} /> : "" }
		{ is_static ? <StaticClassAdmonition /> : "" }
	</>
);

<!-- Block of Constructor -->
export const ConstructorDeclaration = ({ class_data }) => (
	<>
		<CodeBlock className="language-lua">
			{ GetConstructorExample(class_data) }
		</CodeBlock>
		<table style={{ width: "100%", display: "table" }}>
			<thead>
				<tr>
					<th>Type</th>
					<th>Name</th>
					<th>Default</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				{class_data.constructor.map(function(value) {
					return <tr>
						<td>{ GetElementByType(value.type) }</td>
						<td><b><code>{ value.name }</code></b></td>
						<td style={{ "white-space": "nowrap" }}>{ value.default != null ? <code>{ value.default }</code> : "" }</td>
						<td style={{"word-break": "break-word"}}>{ value.description }</td>
					</tr>;
				})}
			</tbody>
		</table>
	</>
);

<!-- Block of Functions -->
export const FunctionsDeclaration = ({ class_data }) => (
	<>
		{ class_data.inheritance && class_data.inheritance.includes("Actor") ? <details><summary>Inherited Actor Functions</summary><BaseActorFunctions /></details> : "" }
		{ class_data.inheritance && class_data.inheritance.includes("Paintable") ? <details><summary>Inherited Paintable Functions</summary><BasePaintableFunctions /></details> : "" }
		{ class_data.inheritance && class_data.inheritance.includes("Pickable") ? <details><summary>Inherited Pickable Functions</summary><BasePickableFunctions /></details> : "" }
		{
			class_data.functions == null ? <i>This entity doesn't have own functions.</i> :
			<>
				<FunctionListDeclaration functions_list={class_data.functions} />
				{ class_data.functions.map((value) => <FunctionDeclaration function_data={value} />) }
			</>
		}
	</>
);

<!-- Block of Static Functions -->
export const StaticFunctionsDeclaration = ({ class_data }) => (
	<>
		{
			class_data.static_functions == null ? <i>This entity doesn't have own static functions.</i> :
			<>
				<FunctionListDeclaration functions_list={class_data.static_functions} />
				{ class_data.static_functions.map((value) => <FunctionDeclaration function_data={value} is_static={true} class_name={class_data.name} />) }
			</>
		}
	</>
);

<!-- Block of Events -->
export const EventsDeclaration = ({ class_data }) => (
	<>
		{ class_data.inheritance && class_data.inheritance.includes("Actor") ? <details><summary>Inherited Actor Events</summary><BaseActorEvents /></details> : "" }
		{ class_data.inheritance && class_data.inheritance.includes("Pickable") ? <details><summary>Inherited Pickable Events</summary><BasePickableEvents /></details> : "" }
		{
			class_data.events == null ? <i>This entity doesn't have own events.</i> :
			<>
				<EventListDeclaration class_data={class_data} />
				{ class_data.events.map((value) => <EventDeclaration data={value} class_name={class_data.name} />) }
			</>
		}
	</>
);