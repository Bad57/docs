import CodeBlock from '@theme/CodeBlock';
import Admonition from '@theme/Admonition';

import { AuthorityType, BasicType, Classes, Structs, Enums, AssetPath } from '@site/docs/components/_nanos.mdx';

import BaseActorFunctions from '@site/docs/scripting-reference/classes/base-classes/_base-actor-functions.mdx';
import BasePaintableFunctions from '@site/docs/scripting-reference/classes/base-classes/_base-paintable-functions.mdx';
import BasePickableFunctions from '@site/docs/scripting-reference/classes/base-classes/_base-pickable-functions.mdx';

import BaseActorEvents from '@site/docs/scripting-reference/classes/base-classes/_base-actor-events.mdx';
import BasePickableEvents from '@site/docs/scripting-reference/classes/base-classes/_base-pickable-events.mdx';

<!-- Asset Paths Map -->
export const AssetPaths = {
	StaticMeshPath: AssetPath.StaticMesh,
	SkeletalMeshPath: AssetPath.SkeletalMesh,
	AnimationPath: AssetPath.Animation,
	ParticlePath: AssetPath.Particle,
	MaterialPath: AssetPath.Material,
	MapPath: AssetPath.Map,
	BlueprintPath: AssetPath.Blueprint,
	SoundPath: AssetPath.Sound,
	ImagePath: AssetPath.Image,
	HTMLPath: AssetPath.HTML,
}

<!-- Gets an Element by it's string type -->
export function GetElementByType(type) {
	const type_uppercase = type.charAt(0).toUpperCase() + type.slice(1);
    const TypeElement =
		BasicType[type_uppercase] ? BasicType[type_uppercase] :
		Classes[type] ? Classes[type] :
		AssetPaths[type] ? AssetPaths[type] :
		Structs[type] ? Structs[type] :
        <Enums>{type}</Enums>;
	return <TypeElement />;
}

<!-- Authority Label Map -->
export const AuthorityLabels = {
    client: <>This class can only be spawned on ðŸŸ§ <a href="/docs/core-concepts/scripting/authority-concepts">Client</a>.</>,
    server: <>This class can only be spawned on ðŸŸ¦ <a href="/docs/core-concepts/scripting/authority-concepts">Server</a>.</>,
    both: <>This class can be spawned on both ðŸŸ§ <a href="/docs/core-concepts/scripting/authority-concepts">Client</a> and ðŸŸ¦ <a href="/docs/core-concepts/scripting/authority-concepts">Server</a> (if you spawn it on client, it won't be synchronized with other players).</>,
}

<!-- Gets a Parameter name (with ? when optional) -->
export function GetParameterName(parameter_data) {
	return `${parameter_data.name}${parameter_data.default != null ? "?" : ""}`;
}

<!-- Gets a list of parameters separated by comma -->
export function GetParametersList(list) {
	return !list ? "" : list.map((value) => GetParameterName(value)).join(", ");
}

<!-- Generates Constructor Example Codeblock -->
export function GetConstructorExample(class_data) {
	return `local my_entity = ${class_data.name}(${GetParametersList(class_data.constructor)})`;
}

<!-- Generates Function Example Codeblock -->
export function GetFunctionExample(function_data) {
	const return_part = !function_data.return ? "" : "local ret = ";
	return `${return_part}my_entity:${function_data.name}(${GetParametersList(function_data.parameters)})`;
}

<!-- Generates Event Example Codeblock -->
export function GetEventExample(class_name, event_data) {
	return `${class_name}.Subscribe("${event_data.name}", function(${GetParametersList(event_data.parameters)})\n\nend)`;
}

<!-- Authority Admonition -->
export const AuthorityAdmonition = ({ authority }) => (
    <Admonition type="info" icon="ðŸ’‚" title="Authority">{ AuthorityLabels[authority] }</Admonition>
);

<!-- Inheritance Admonition -->
export const InheritanceAdmonition = ({ inheritance }) => (
    <Admonition type="info" icon="ðŸ‘ª" title="Inheritance">
        This class inheritance from { inheritance.map(inherit => GetElementByType(inherit)).reduce((prev, next) => [prev, ", ", next]) }.
    </Admonition>
);

<!-- Gets Authority Element by string -->
export function GetAuthorityType(authority) {
    return authority == "server-only" ? <AuthorityType.ServerOnly /> :
    authority == "client-only" ? <AuthorityType.ClientOnly /> :
    authority == "authority-only" ? <AuthorityType.AuthorityOnly /> : <AuthorityType.Both />;
};

<!-- Function Block Declaration -->
export const FunctionDeclaration = ({ data }) => (
	<>
		<h3 id={data.name.toLowerCase()}>
			{ GetAuthorityType(data.authority) }
			<code>
				{data.name}
			</code>
		</h3>
		<blockquote>
			{data.description}
		</blockquote>
		<CodeBlock className="language-lua">
			{ GetFunctionExample(data) }
		</CodeBlock>
		{Array.isArray(data.parameters) && data.parameters.length > 0 ?
			<table style={{ width: "100%", display: "table" }}>
				<thead>
					<th>Type</th>
					<th>Parameter</th>
					<th>Default Value</th>
					<th>Description</th>
				</thead>
				<tbody>
					{data.parameters.map(function(value) {
						return <tr>
							<td>{ GetElementByType(value.type) }</td>
							<td><code>{ GetParameterName(value) }</code></td>
							<td>{ value.default != null ? <code>{value.default}</code> : "" }</td>
							<td>{ value.description }</td>
						</tr>;
					})}
				</tbody>
			</table>
		: <></>}
		<hr />
	</>
);

<!-- Event Block Declaration -->
export const EventDeclaration = ({ data, class_name }) => (
	<>
		<h3 id={data.name.toLowerCase()}>
			{ GetAuthorityType(data.authority) }
			<code>
				{data.name}
			</code>
		</h3>
		<blockquote>
			{data.description}
		</blockquote>
		<CodeBlock className="language-lua">
			{ GetEventExample(class_name, data) }
		</CodeBlock>
		{Array.isArray(data.arguments) && data.arguments.length > 0 ?
			<table>
				<thead>
					<th>Type</th>
					<th>Argument</th>
					<th>Description</th>
				</thead>
				<tbody>
					{data.arguments.map(function(value) {
						return <tr>
							<td>{ GetElementByType(value.type) }</td>
							<td><code>{ value.name }</code></td>
							<td>{ value.description }</td>
						</tr>;
					})}
				</tbody>
			</table>
		: <></>}
		<hr />
	</>
);

<!-- Function List Declaration -->
export const FunctionListDeclaration = ({ class_data }) => (
    <table style={{ width: "100%", display: "table" }}>
        <thead>
            <th></th>
            <th>Returns</th>
            <th>Name</th>
            <th>Description</th>
        </thead>
        <tbody>
            {class_data.functions.map(function(value) {
                return <tr>
                    <td width="50px">{ GetAuthorityType(value.authority) } </td>
                    <td>{ value.return ? GetElementByType(value.return) : "" }</td>
                    <td><b><a href={`#${value.name.toLowerCase()}`}><code>{ value.name }</code></a></b></td>
                    <td>{ value.description }</td>
                </tr>;
            })}
        </tbody>
    </table>
);

<!-- Events List Declaration -->
export const EventListDeclaration = ({ class_data }) => (
    <table style={{ width: "100%", display: "table" }}>
        <thead>
            <th></th>
            <th>Name</th>
            <th>Description</th>
        </thead>
        <tbody>
            {class_data.events.map(function(value) {
                return <tr>
                    <td width="50px">{ GetAuthorityType(value.authority) } </td>
                    <td><b><a href={`#${value.name.toLowerCase()}`}><code>{ value.name }</code></a></b></td>
                    <td>{ value.description }</td>
                </tr>;
            })}
        </tbody>
    </table>
);

<!-- Header Block Declaration -->
export const HeaderDeclaration = ({ class_data, image }) => (
    <>
        <p>
            { class_data.description }
        </p>
        <p>
            <img src={image} />
        </p>
        <AuthorityAdmonition authority={class_data.authority} />
        <InheritanceAdmonition inheritance={class_data.inheritance} />
    </>
);

<!-- Block of Constructor -->
export const ConstructorDeclaration = ({ class_data }) => (
    <>
        <CodeBlock className="language-lua">
            { GetConstructorExample(class_data) }
        </CodeBlock>
        <table style={{ width: "100%", display: "table" }}>
            <thead>
                <th>Type</th>
                <th>Name</th>
                <th>Default</th>
                <th>Description</th>
            </thead>
            <tbody>
                {class_data.constructor.map(function(value) {
                    return <tr>
                        <td>{ GetElementByType(value.type) }</td>
                        <td><b><code>{ value.name }</code></b></td>
                        <td>{ value.default != null ? <code>{ value.default }</code> : "" }</td>
                        <td>{ value.description }</td>
                    </tr>;
                })}
            </tbody>
        </table>
    </>
);

<!-- Block of Functions -->
export const FunctionsDeclaration = ({ class_data }) => (
    <>
        { class_data.inheritance.includes("Actor") ? <details><summary>Inherited Actor Functions</summary><BaseActorFunctions /></details> : "" }
        { class_data.inheritance.includes("Paintable") ? <details><summary>Inherited Paintable Functions</summary><BasePaintableFunctions /></details> : "" }
        { class_data.inheritance.includes("Pickable") ? <details><summary>Inherited Pickable Functions</summary><BasePickableFunctions /></details> : "" }
        {
            class_data.functions == null ? <i>This entity doesn't have own functions.</i> :
            <>
                <FunctionListDeclaration class_data={class_data} />
                { class_data.functions.map((value) => <FunctionDeclaration data={value} />) }
            </>
        }
    </>
);

<!-- Block of Events -->
export const EventsDeclaration = ({ class_data }) => (
    <>
        { class_data.inheritance.includes("Actor") ? <details><summary>Inherited Actor Events</summary><BaseActorEvents /></details> : "" }
        { class_data.inheritance.includes("Pickable") ? <details><summary>Inherited Pickable Events</summary><BasePickableEvents /></details> : "" }
        {
            class_data.events == null ? <i>This entity doesn't have own events.</i> :
            <>
                <EventListDeclaration class_data={class_data} />
                { class_data.events.map((value) => <EventDeclaration data={value} class_name={class_data.name} />) }
            </>
        }
    </>
);